<div class="grid wide body-content">

    <div class="breadcrumb">
      <a href="/">Trang chủ</a>
      <span>&gt;</span>
      <a href="/search?category={{product.category}}">{{product.category}}</a>
      <span>&gt;</span>
      <a href="/search?material={{product.material}}">{{product.material}}</a>
      <span>&gt;</span>
      <a class="active">{{product.name}}</a>
    </div>
    <div class="row body-product">
      <!--Gallery -->
      <div class="col l-7 product-images">
        <div class="product-gallery">
          <div class="thumbnails">
              <button class="up-button"><i class="fa fa-chevron-up fa-2x" aria-hidden="true" ></i></button>
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/on-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-2.jpg" alt="Thumbnail 1" class="thumbnail">
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/on-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-2.jpg" alt="Thumbnail 2" class="thumbnail">
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/sp-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-2.png" alt="Thumbnail 3" class="thumbnail">
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/on-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-2.jpg" alt="Thumbnail 3" class="thumbnail">
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/on-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-2.jpg" alt="Thumbnail 3" class="thumbnail">
              <button class="up-button"><i class="fa fa-chevron-down fa-2x" aria-hidden="true"></i></button>
          </div>
          <div class="main-image-outer">
              <img src="https://cdn.pnj.io/images/thumbnails/485/485/detailed/182/sp-GD0000W000948-day-chuyen-vang-trang-y-18k-pnj-1.png" alt="Product Image 1" class="main-image">
          </div>
        </div>
      </div>
      <!--Gallery -->

      <!-- Details -->
      <div class="col l-4 product-details">

        <div class="product-name-wrapper">
          <img src="https://cdn.pnj.io/images/image-update/2022/10/pnjfast/PNJfast-Giaotrong3h.svg" alt="pnj" class="product-name-image">
          <h3 class="product-name">{{product.name}}</h3>
        </div>

        <div class="product-sku-wrapper">
          <h4 class="product-sku">Mã: {{product.sku}}</h4>
        </div>

        <div class="row product-price-wrapper">
          <div class="col l-6 ">
            <span class="product-price" id="price">{{#formatCurrency product.price}}{{/formatCurrency}}</span>
          </div>
        </div>

        <div class="product-selector">
          <h3 class="product-size-title">Chọn {{product.size_title}}:</h3>
          <div class="product-size-list">
            {{#each product.sizes}}
            <span class="product-size">{{this}}</span>
            {{/each}}
          </div>
        </div>

        <div class="row product-stock-wrapper">
            <span class="product-stock-status">Còn {{product.quantity}} sản phẩm</span>
        </div>
        <div class="add-to-cart-wrapper">
          <button class="add-to-cart-btn">
            <span class="add-to-cart-span-tittle"> Mua ngay</span>
            <span class="add-to-cart-span">Miễn phí giao hàng tận nhà hoặc nhận tại cửa hàng</span>
          </button>
        </div>

        <div class="row add-to-cart-wrapper" >
          <div class="col l-6">
            <button class="add-to-whilist-btn" onclick="addCart({{product.sku}})">
              
            </button>
          </div>

          <div class="col l-6">
            <button class="add-to-whilist-btn">
              <span class="add-to-cart-span-tittle"> <i class="fa fa-heart" aria-hidden="true"></i> Thêm vào yêu thích</span>
              <span class="add-to-cart-span">Dễ dàng xem lại sản phẩm</span>
            </button>
          </div>
        </div>
      </div>
    </div>
</div>

    <div class="modal-cart">
        <div class="cart__overlay"></div>
        <div class="cart">

                <div class="cart__title">
                    <h2>CART</h2>
                    
                </div>

                <div class="listCart">

                </div>

                <div class="buttons">
                    <button class="close">
                        EDIT ORDER
                        <img src="/image/edit.png" alt="" style="margin-left: 10px">
                    </button>
                    <button class="checkout">
                        <a href="/cart/checkout">CHECKOUT</a>
                    </button>
                </div>
        </div>
    </div>

<script>
    let iconCart = document.querySelector('.iconCart');
    let cart = document.querySelector('.cart');
    let close = document.querySelector('.close');
    let overlay = document.querySelector('.cart__overlay')

    iconCart.addEventListener('click', function(){
        if(cart.style.right == '-100%'){
            cart.style.right = '0';
            overlay.style.display = 'block';

            
        }else{
            overlay.style.display = 'none';
            cart.style.right = '-100%';
            
        }
    })
    close.addEventListener('click', function (){
        cart.style.right = '-100%';
        overlay.style.display = 'none';

    })

    let products = {{{jsonProduct}}};
    
    let listCart = [];
    function checkCart(){
        var cookieValue = document.cookie
        .split('; ')
        .find(row => row.startsWith('listCart='));
        if(cookieValue){
            listCart = JSON.parse(cookieValue.split('=')[1]);
        }else{
            listCart = [];
        }
    }
        checkCart();
    function addCart($skuProduct){

        console.log($skuProduct);
        let productsCopy = JSON.parse(JSON.stringify(products));
        console.log(productsCopy);
        //// If this product is not in the cart
        console.log(listCart);
        if(!listCart[$skuProduct]) 
        {
            listCart[$skuProduct] = productsCopy.filter(product => product.sku == $skuProduct)[0];
            console.log(listCart[$skuProduct]);
            listCart[$skuProduct].quantity = 1;
        }else{
            console.log(listCart[$skuProduct]);

            //If this product is already in the cart.
            //I just increased the quantity
            listCart[$skuProduct].quantity++;
        }
        document.cookie = "listCart=" + JSON.stringify(listCart) + "; expires=Thu, 31 Dec 2025 23:59:59 UTC; path=/;";

        addCartToHTML();
    }

    addCartToHTML();
    function addCartToHTML(){
        // clear data default
        let listCartHTML = document.querySelector('.listCart');
        listCartHTML.innerHTML = '';

        let totalHTML = document.querySelector('.totalQuantity');
        let totalQuantity = 0;
        // if has product in Cart
        if(listCart){
            listCart.forEach(product => {
                if(product){
                    let newCart = document.createElement('div');
                    newCart.classList.add('item');
                    newCart.innerHTML = 
                        `<img src="${product.thumbnail[0]}">
                        <div class="content">
                            <div class="name">${product.name}</div>
                            <div class="price">$${product.price} / 1 product</div>
                        </div>
                        <div class="quantity">
                            <button onclick="changeQuantity(${product.sku}, '-')">-</button>
                            <span class="value">${product.quantity}</span>
                            <button onclick="changeQuantity(${product.sku}, '+')">+</button>
                        </div>`;
                    listCartHTML.appendChild(newCart);
                    totalQuantity = totalQuantity + product.quantity;
                }
            })
        }
        totalHTML.innerText = totalQuantity;
    }

    function changeQuantity($skuProduct, $type){
        switch ($type) {
            case '+':
                listCart[$skuProduct].quantity++;
                break;
            case '-':
                listCart[$skuProduct].quantity--;

                // if quantity <= 0 then remove product in cart
                if(listCart[$skuProduct].quantity <= 0){
                    delete listCart[$skuProduct];
                }
                break;
        
            default:
                break;
        }
        // save new data in cookie
        document.cookie = "listCart=" + JSON.stringify(listCart) + "; expires=Thu, 31 Dec 2025 23:59:59 UTC; path=/;";
        // reload html view cart
        addCartToHTML();
    }

</script>